A51 MACRO ASSEMBLER  TEST                                                                 11/12/2025 11:54:35 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Users\argha\Desktop\testing\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst
                      ) OBJECT(.\Objects\test.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;===========================================================
                       2     ; TWO-WAY TRAFFIC LIGHT CONTROLLER WITH AMBULANCE PRIORITY
                       3     ; MCU   : AT89S52 (8051 family)
                       4     ; XTAL  : 12 MHz
                       5     ;===========================================================
                       6     
0000                   7     ORG 0000H
0000 020030            8     LJMP START        ; Main program start
                       9     
                      10     ; --- Interrupt vector for external interrupt 0 (INT0) ---
0003                  11     ORG 0003H
0003 020064           12     LJMP AMB_ISR
                      13     
                      14     ;===========================================================
                      15     ; BIT DEFINITIONS
                      16     ;===========================================================
                      17     
                      18     ; Main Road lights (Road A)
  0090                19     A_RED   BIT P1.0
  0091                20     A_YEL   BIT P1.1
  0092                21     A_GRN   BIT P1.2
                      22     
                      23     ; Cross Road lights (Road B)
  0093                24     B_RED   BIT P1.3
  0094                25     B_YEL   BIT P1.4
  0095                26     B_GRN   BIT P1.5
                      27     
                      28     ; Ambulance indicator LED
  00A0                29     AMB_IND BIT P2.0    ; P2.0 lights up during interrupt
                      30     
                      31     ;===========================================================
                      32     ; MAIN PROGRAM
                      33     ;===========================================================
                      34     
0030                  35     ORG 0030H
0030                  36     START:
0030 75A881           37         MOV IE, #10000001B     ; EA=1, EX0=1 enable external interrupt
0033 758801           38         MOV TCON, #00000001B   ; Edge triggered INT0
0036 C2A0             39         CLR AMB_IND             ; Ensure indicator off at start
                      40     
0038                  41     MAIN_LOOP:
                      42     
                      43         ; --- MAIN ROAD GREEN, CROSS ROAD RED ---
0038 C2A0             44         CLR AMB_IND
003A D292             45         SETB A_GRN
003C D293             46         SETB B_RED
003E C291             47         CLR  A_YEL
0040 C290             48         CLR  A_RED
0042 C294             49         CLR  B_YEL
0044 C295             50         CLR  B_GRN
0046 1182             51         ACALL DELAY10S
                      52     
                      53         ; --- MAIN ROAD YELLOW ---
0048 C292             54         CLR  A_GRN
004A D291             55         SETB A_YEL
004C 117B             56         ACALL DELAY3S
004E C291             57         CLR  A_YEL
A51 MACRO ASSEMBLER  TEST                                                                 11/12/2025 11:54:35 PAGE     2

0050 D290             58         SETB A_RED
                      59     
                      60         ; --- CROSS ROAD GREEN ---
0052 D295             61         SETB B_GRN
0054 C293             62         CLR  B_RED
0056 1182             63         ACALL DELAY10S
                      64     
                      65         ; --- CROSS ROAD YELLOW ---
0058 C295             66         CLR  B_GRN
005A D294             67         SETB B_YEL
005C 117B             68         ACALL DELAY3S
005E C294             69         CLR  B_YEL
0060 D293             70         SETB B_RED
                      71     
0062 80D4             72         SJMP MAIN_LOOP
                      73     
                      74     ;===========================================================
                      75     ; AMBULANCE INTERRUPT SERVICE ROUTINE
                      76     ;===========================================================
0064                  77     AMB_ISR:
0064 D2A0             78         SETB AMB_IND             ; Turn ON indicator on P2.0
0066 D292             79         SETB A_GRN               ; Main road green
0068 C290             80         CLR  A_RED
006A C291             81         CLR  A_YEL
006C D293             82         SETB B_RED
006E C294             83         CLR  B_YEL
0070 C295             84         CLR  B_GRN
                      85     
0072 1182             86         ACALL DELAY10S           ; 10 seconds ambulance priority
                      87     
0074 C2A0             88         CLR  AMB_IND             ; Turn OFF indicator after ISR
0076 D290             89         SETB A_RED
0078 C292             90         CLR  A_GRN
007A 32               91         RETI
                      92     
                      93     ;===========================================================
                      94     ; DELAY SUBROUTINES (accurate for ~12 MHz)
                      95     ;===========================================================
                      96     
                      97     ; ~3 seconds
007B                  98     DELAY3S:
007B 7F46             99         MOV R7, #70
007D                 100     D3_LOOP:
007D 1189            101         ACALL DELAY50MS
007F DFFC            102         DJNZ R7, D3_LOOP
0081 22              103         RET
                     104     
                     105     ; ~10 seconds
0082                 106     DELAY10S:
0082 7FE6            107         MOV R7, #230
0084                 108     D10_LOOP:
0084 1189            109         ACALL DELAY50MS
0086 DFFC            110         DJNZ R7, D10_LOOP
0088 22              111         RET
                     112     
                     113     ; ~50 ms base delay
0089                 114     DELAY50MS:
0089 7EC8            115         MOV R6, #200
008B                 116     D50_OUTER:
008B 7DC8            117         MOV R5, #200
008D                 118     D50_INNER:
008D DDFE            119         DJNZ R5, D50_INNER
008F DEFA            120         DJNZ R6, D50_OUTER
0091 22              121         RET
                     122     
                     123     END
A51 MACRO ASSEMBLER  TEST                                                                 11/12/2025 11:54:35 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AMB_IND. . . . . .  B ADDR   00A0H.0 A   
AMB_ISR. . . . . .  C ADDR   0064H   A   
A_GRN. . . . . . .  B ADDR   0090H.2 A   
A_RED. . . . . . .  B ADDR   0090H.0 A   
A_YEL. . . . . . .  B ADDR   0090H.1 A   
B_GRN. . . . . . .  B ADDR   0090H.5 A   
B_RED. . . . . . .  B ADDR   0090H.3 A   
B_YEL. . . . . . .  B ADDR   0090H.4 A   
D10_LOOP . . . . .  C ADDR   0084H   A   
D3_LOOP. . . . . .  C ADDR   007DH   A   
D50_INNER. . . . .  C ADDR   008DH   A   
D50_OUTER. . . . .  C ADDR   008BH   A   
DELAY10S . . . . .  C ADDR   0082H   A   
DELAY3S. . . . . .  C ADDR   007BH   A   
DELAY50MS. . . . .  C ADDR   0089H   A   
IE . . . . . . . .  D ADDR   00A8H   A   
MAIN_LOOP. . . . .  C ADDR   0038H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
START. . . . . . .  C ADDR   0030H   A   
TCON . . . . . . .  D ADDR   0088H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
